<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Innovate Comms: Strategy Cube</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Master Content -->
    <script src="master_content.js"></script>
    
    <style>
        :root {
            --agate: #D6883A;
            --aventurine: #3E9B9B;
            --azurite: #842366;
            --bloodstone: #15404F;
            --alexandrite: #4C194C;
            --bg-dark: #050a10;
        }

        body {
            margin: 0;
            background-color: var(--bg-dark);
            font-family: 'Inter', sans-serif;
            color: #fff;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            perspective: 1200px;
        }

        /* Atmosphere Layers */
        #bg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            transition: background 1s ease;
        }

        .bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; transition: opacity 1s ease;
        }
        .bg-layer.active { opacity: 1; }

        /* Default Atmosphere (A) */
        #bg-default {
            background: radial-gradient(circle at center, var(--bloodstone) 0%, var(--bg-dark) 100%);
        }

        #bg-agate {
            background: radial-gradient(circle at center, var(--agate) 0%, var(--bg-dark) 100%);
        }

        #bg-azurite {
            background: radial-gradient(circle at center, var(--azurite) 0%, var(--bg-dark) 100%);
        }

        #bg-aventurine {
            background: radial-gradient(circle at center, var(--aventurine) 0%, var(--bg-dark) 100%);
        }

        /* LEO Atmosphere (Stars) */
        #bg-stars { background: #000; overflow: hidden; }

        /* Quantum Atmosphere (B) */
        #bg-quantum { background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); }

        /* UI Overlays */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between; padding: 40px;
            z-index: 100;
        }

        h1 {
            font-family: 'Syncopate', sans-serif; font-size: 1.5rem; letter-spacing: 10px; margin: 0;
            text-transform: uppercase; color: var(--agate);
            display: flex; align-items: center; gap: 15px; /* Added flex for logo alignment */
        }

        .logo-icon {
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            width: 35px; height: 35px; /* Slightly shrunken for better fit */
        }

        .hint {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            font-size: 0.7rem; letter-spacing: 3px; opacity: 0.5; text-transform: uppercase;
        }

        /* The Cube */
        .scene {
            width: 400px; height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1.2);
            cursor: pointer;
        }

        .face {
            position: absolute; width: 400px; height: 400px;
            background: rgba(0, 0, 0, 0.4); /* Darker background for higher contrast */
            backdrop-filter: blur(5px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 25px; box-sizing: border-box; /* Reduced padding from 40px */
            backface-visibility: hidden;
            transition: all 0.5s ease;
        }

        .face.active { border-color: var(--agate); background: rgba(0, 0, 0, 0.6); }

        .face h2 { 
            font-family: 'Syncopate', sans-serif; 
            font-size: 1rem; /* Slightly smaller header */
            letter-spacing: 2px; 
            margin: 10px 0 5px; /* Reduced margins */
            text-align: center;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            color: var(--agate);
        }
        .face p { 
            font-size: 0.85rem; 
            line-height: 1.4; /* Tighter line height */
            color: #eee; 
            text-align: center; 
            font-weight: 400;
            text-shadow: 0 1px 5px rgba(0,0,0,0.5);
            margin-bottom: 8px; /* Reduced margin */
        }
        .face .icon { font-size: 2.5rem; color: var(--agate); margin-bottom: 5px; } /* Smaller icon */

        .impact-box {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 15px; /* Increased from 8px */
            width: 100%;
            text-align: center;
            margin-top: 5px;
        }
        .stat-highlight {
            display: block;
            font-size: 0.95rem; 
            font-weight: 700;
            color: var(--agate);
            margin-bottom: 8px; /* Increased from 2px */
            letter-spacing: 1px;
        }
        .stat-desc {
            font-size: 0.75rem;
            opacity: 0.9; /* Increased opacity */
            color: #eee; /* Brighter color */
            line-height: 1.4; /* Slightly looser */
        }

        /* Positioning Faces */
        .front  { transform: rotateY(0deg) translateZ(200px); }
        .right  { transform: rotateY(90deg) translateZ(200px); }
        .back   { transform: rotateY(180deg) translateZ(200px); }
        .left   { transform: rotateY(-90deg) translateZ(200px); }
        .top    { transform: rotateX(90deg) translateZ(200px); background: #000; border-color: var(--bloodstone); }
        .bottom { transform: rotateX(-90deg) translateZ(200px); background: #000; border-color: var(--alexandrite); }

        /* Navigation Dots */
        .dots {
            display: flex; gap: 15px; pointer-events: auto; justify-content: center; margin-bottom: 20px;
        }
        .dot {
            width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.2);
            cursor: pointer; transition: 0.3s;
        }
        .dot.active { background: var(--agate); transform: scale(1.5); box-shadow: 0 0 10px var(--agate); }

        .btn-exit { position: fixed; top: 40px; right: 40px; color: #666; text-decoration: none; font-size: 0.7rem; pointer-events: auto; }

        /* Conclusion Overlay */
        #conclusion-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 10, 16, 0.95);
            display: flex; align-items: center; justify-content: center;
            z-index: 200; opacity: 0; pointer-events: none; transition: 1s ease;
            backdrop-filter: blur(20px);
        }
        #conclusion-overlay.active { opacity: 1; pointer-events: auto; }
        
        .conclusion-content {
            max-width: 600px; text-align: center; padding: 40px;
        }
        .conclusion-content h2 { font-family: 'Syncopate', sans-serif; letter-spacing: 10px; color: var(--agate); margin-bottom: 30px; }
        .conclusion-content p { font-size: 1.1rem; line-height: 1.8; color: #ccc; margin-bottom: 20px; }

        .btn-action {
            background: transparent; border: 1px solid var(--agate); color: var(--agate);
            padding: 15px 40px; border-radius: 50px; cursor: pointer; font-family: 'Syncopate', sans-serif;
            font-size: 0.7rem; letter-spacing: 2px; transition: 0.3s; margin-top: 20px;
        }
        .btn-action:hover { background: var(--agate); color: #fff; }

        /* Mobile specific adjustments */
        @media (max-width: 480px) {
            .scene { width: 320px; height: 320px; }
            .face { width: 320px; height: 320px; padding: 25px; }
            .front  { transform: rotateY(0deg) translateZ(160px); }
            .right  { transform: rotateY(90deg) translateZ(160px); }
            .back   { transform: rotateY(180deg) translateZ(160px); }
            .left   { transform: rotateY(-90deg) translateZ(160px); }
            .top    { transform: rotateX(90deg) translateZ(160px); }
            .bottom { transform: rotateX(-90deg) translateZ(160px); }
            .face p { font-size: 0.8rem; }
            .face h2 { font-size: 0.9rem; }
            .stat-highlight { font-size: 0.9rem; }
            .stat-desc { font-size: 0.7rem; }
        }

    </style>
</head>
<body>

    <div id="bg-container">
        <div class="bg-layer active" id="bg-default"></div>
        <div class="bg-layer" id="bg-agate"></div>
        <div class="bg-layer" id="bg-azurite"></div>
        <div class="bg-layer" id="bg-aventurine"></div>
        <div class="bg-layer" id="bg-stars"></div>
        <div class="bg-layer" id="bg-quantum"></div>
    </div>

    <div id="ui">
        <h1>
            <a href="https://www.innovatecomms.co.uk/" id="company-link" style="color: inherit; text-decoration: none; pointer-events: auto; display: flex; align-items: center; gap: 15px;">
                <svg class="logo-icon" viewBox="0 0 45 45" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.8981 42.9916V2.34497L1.77832 13.4648V31.8718L12.8981 42.9916Z"></path>
                    <path d="M31.3051 2.34497L42.4249 13.4648V31.8718L31.3051 42.9916L12.8981 22.6678L31.3051 2.34497Z"></path>
                    <path d="M42.4252 13.4648L31.6953 22.6678L42.4252 31.8718"></path>
                    <path d="M31.3047 2.34497V42.9916"></path>
                    <path d="M1.77832 13.4648L12.7364 22.6508L1.77832 31.8718"></path>
                </svg>
                Innovate Comms
            </a>
        </h1>
        <div class="dots" id="dots">
            <div class="dot active" onclick="rotateTo(0)"></div>
            <div class="dot" onclick="rotateTo(1)"></div>
            <div class="dot" onclick="rotateTo(2)"></div>
            <div class="dot" onclick="rotateTo(3)"></div>
            <div class="dot" onclick="rotateTo(4)"></div>
            <div class="dot" onclick="rotateTo(5)"></div>
            <div class="dot" onclick="showConclusion()" title="Conclusion"><i class="fas fa-flag-checkered" style="font-size: 0.6rem;"></i></div>
        </div>
    </div>

    <div id="conclusion-overlay">
        <div class="conclusion-content">
            <h2 id="outro-title">THE ROAD AHEAD</h2>
            <p id="outro-p1"></p>
            <p id="outro-p2"></p>
            <button class="btn-action" onclick="hideConclusion()">REPLAY</button>
        </div>
    </div>

    <div class="hint">SCROLL OR TAP TO ROTATE</div>

    <div class="scene" id="cube" onclick="rotateNext()">
        <!-- Face 0: Intro -->
        <div class="face front">
            <div class="icon"><i class="fas fa-cube"></i></div>
            <h2 id="intro-title"></h2>
            <p id="intro-p1"></p>
            <div class="impact-box">
                <div class="stat-desc" id="intro-p2"></div>
            </div>
        </div>
        
        <!-- Faces 1-5 will be populated by JS -->
        <div class="face right" id="face-1"></div>
        <div class="face back" id="face-2"></div>
        <div class="face left" id="face-3"></div>
        <div class="face top" id="face-4"></div>
        <div class="face bottom" id="face-5"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Observer.min.js"></script>
    <script>
        gsap.registerPlugin(Observer);

        // --- BACKGROUND ENGINES ---
        const initStars = () => {
            const container = document.getElementById('bg-stars');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            const starGeo = new THREE.BufferGeometry();
            const starPos = [];
            for(let i=0; i<2000; i++) {
                starPos.push((Math.random()-0.5)*100, (Math.random()-0.5)*100, (Math.random()-0.5)*100);
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
            const starMesh = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0xffffff, size: 0.1}));
            scene.add(starMesh);
            camera.position.z = 5;

            const anim = () => {
                requestAnimationFrame(anim);
                starMesh.rotation.y += 0.0005;
                renderer.render(scene, camera);
            };
            anim();
        };

        const initQuantum = () => {
            const container = document.getElementById('bg-quantum');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            const particleCount = 1000;
            const qGeo = new THREE.BufferGeometry();
            const qPos = new Float32Array(particleCount * 3);
            const qColors = new Float32Array(particleCount * 3);

            const colorPalette = [
                new THREE.Color('#D6883A'), // Agate
                new THREE.Color('#3E9B9B'), // Aventurine
                new THREE.Color('#842366')  // Azurite
            ];

            for(let i=0; i<particleCount; i++) {
                qPos[i * 3] = (Math.random() - 0.5) * 40;
                qPos[i * 3 + 1] = (Math.random() - 0.5) * 40;
                qPos[i * 3 + 2] = (Math.random() - 0.5) * 40;

                const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                qColors[i * 3] = color.r;
                qColors[i * 3 + 1] = color.g;
                qColors[i * 3 + 2] = color.b;
            }

            qGeo.setAttribute('position', new THREE.BufferAttribute(qPos, 3));
            qGeo.setAttribute('color', new THREE.BufferAttribute(qColors, 3));

            const qMat = new THREE.PointsMaterial({
                size: 0.15,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            const qMesh = new THREE.Points(qGeo, qMat);
            scene.add(qMesh);
            camera.position.z = 10;

            const anim = () => {
                requestAnimationFrame(anim);
                qMesh.rotation.z += 0.001;
                qMesh.rotation.y += 0.0005;
                renderer.render(scene, camera);
            };
            anim();
        };

        initStars();
        initQuantum();

        // --- MASTER CONTENT LOADER ---
        function loadMasterContent() {
            const config = TELECOMS_CONFIG;
            
            // Branding
            const companyLink = document.getElementById('company-link');
            // Update the text portion (the last child) without removing the SVG
            companyLink.lastChild.textContent = " " + config.branding.companyName;
            companyLink.href = config.branding.website;

            // Intro
            document.getElementById('intro-title').innerText = config.intro.title.toUpperCase();
            document.getElementById('intro-p1').innerText = config.intro.subtitle || config.intro.p1;
            document.getElementById('intro-p2').innerText = config.intro.p2;

            // Outro
            document.getElementById('outro-title').innerText = config.outro.title.toUpperCase();
            document.getElementById('outro-p1').innerText = config.outro.p1;
            
            // Convert email to link in outro p2
            const email = config.branding.email;
            let p2 = config.outro.p2;
            p2 = p2.replace(email, `<a href="mailto:${email}" style="color:var(--agate); text-decoration:none; font-weight:bold;">${email}</a>`);
            document.getElementById('outro-p2').innerHTML = p2;

            // Faces 1-5
            config.trends.forEach((trend, i) => {
                const face = document.getElementById(`face-${i+1}`);
                if (face) {
                    face.innerHTML = `
                        <div class="icon" style="color:${trend.color}"><i class="fas ${trend.icon}"></i></div>
                        <h2 style="color:${trend.color}">${trend.title.toUpperCase()}</h2>
                        <p>${trend.desc}</p>
                        <div class="impact-box">
                            <span class="stat-highlight" style="color:${trend.color}">${trend.stat.toUpperCase()}</span>
                            <div class="stat-desc">${trend.implication || trend.statDesc}</div>
                        </div>
                    `;
                }
            });
        }

        // --- CUBE LOGIC ---
        const cube = document.getElementById('cube');
        const dots = document.querySelectorAll('.dot');
        const bgLayers = {
            default: document.getElementById('bg-default'),
            agate: document.getElementById('bg-agate'),
            azurite: document.getElementById('bg-azurite'),
            aventurine: document.getElementById('bg-aventurine'),
            stars: document.getElementById('bg-stars'),
            quantum: document.getElementById('bg-quantum')
        };

        let currentFace = 0;
        let isTransitioning = false;

        const rotations = [
            { x: 0, y: 0 },      // Front (Intro) -> DEFAULT (BLOODSTONE)
            { x: 0, y: -90 },    // Right (5G) -> AGATE
            { x: 0, y: -180 },   // Back (AI) -> AZURITE
            { x: 0, y: -270 },   // Left (Edge) -> AVENTURINE
            { x: -90, y: 0 },    // Top (Sat) -> STARS
            { x: 90, y: 0 }      // Bottom (Security) -> QUANTUM
        ];

        function rotateNext() {
            if(isTransitioning) return;
            if(currentFace === 5) {
                showConclusion();
                return;
            }
            currentFace = (currentFace + 1) % rotations.length;
            applyRotation();
        }

        function rotatePrev() {
            if(isTransitioning) return;
            currentFace = (currentFace - 1 + rotations.length) % rotations.length;
            applyRotation();
        }

        function rotateTo(idx) {
            if(isTransitioning) return;
            currentFace = idx;
            applyRotation();
        }

        const conclusionOverlay = document.getElementById('conclusion-overlay');

        function showConclusion() {
            stopIdle();
            conclusionOverlay.classList.add('active');
            // Update dots
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === 6);
            });
        }

        function hideConclusion() {
            conclusionOverlay.classList.remove('active');
            rotateTo(0);
        }

        function applyRotation() {
            if(isTransitioning) return;
            isTransitioning = true;
            stopIdle();
            
            const rot = rotations[currentFace];
            cube.style.transform = `rotateX(${rot.x}deg) rotateY(${rot.y}deg)`;
            
            // Update Atmosphere
            Object.values(bgLayers).forEach(l => l.classList.remove('active'));
            
            if(currentFace === 0) bgLayers.default.classList.add('active');
            else if(currentFace === 1) bgLayers.agate.classList.add('active');
            else if(currentFace === 2) bgLayers.azurite.classList.add('active');
            else if(currentFace === 3) bgLayers.aventurine.classList.add('active');
            else if(currentFace === 4) bgLayers.stars.classList.add('active');
            else if(currentFace === 5) bgLayers.quantum.classList.add('active');

            // Update Dots
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentFace);
            });

            // Lock input for 1.2 seconds to allow animation to complete and prevent skipping
            setTimeout(() => { isTransitioning = false; }, 1200);
        }

        // Initial subtle spin
        let initialRot = 0;
        const idle = setInterval(() => {
            if (currentFace === 0 && !isTransitioning) {
                initialRot -= 0.2;
                cube.style.transform = `rotateX(-10deg) rotateY(${initialRot}deg)`;
            } else {
                clearInterval(idle);
            }
        }, 20);

        const stopIdle = () => {
            if (idle) {
                clearInterval(idle);
                // Instantly reset to neutral before first real rotation to avoid jitter
                if (currentFace === 0) {
                    cube.style.transform = `rotateX(0deg) rotateY(0deg)`;
                }
            }
        };

        // Initialize
        window.addEventListener('load', () => {
            loadMasterContent();
            // Rest of your init logic...
        });

        // Interaction
        cube.addEventListener('mousedown', stopIdle);
        cube.addEventListener('touchstart', stopIdle);

        // Scroll Jacking with GSAP Observer
        Observer.create({
            target: window,
            type: "wheel,touch",
            onUp: () => {
                if(!isTransitioning) rotatePrev();
            },
            onDown: () => {
                if(!isTransitioning) rotateNext();
            },
            wheelSpeed: 1,
            tolerance: 20, // Increased tolerance
            preventDefault: true
        });

    </script>
</body>
</html>
