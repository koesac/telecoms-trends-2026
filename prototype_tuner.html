<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future of Telecoms: Tuner</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            margin: 0;
            background-color: #111;
            color: #ff9900;
            font-family: 'Share Tech Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        #tuner-display {
            width: 80%;
            max-width: 800px;
            height: 150px;
            background: #000;
            border: 4px solid #333;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(255, 153, 0, 0.2);
        }

        #frequency-scale {
            position: absolute;
            top: 0; left: 0; height: 100%; width: 100%;
            background-image: 
                linear-gradient(90deg, #333 1px, transparent 1px),
                linear-gradient(90deg, #333 1px, transparent 1px);
            background-size: 100px 100%, 20px 20%;
            background-repeat: repeat-x;
            background-position: 0 0, 0 bottom;
        }

        #needle {
            position: absolute;
            top: 0; left: 50%;
            width: 2px; height: 100%;
            background: #ff3300;
            box-shadow: 0 0 10px #ff3300;
            z-index: 10;
            pointer-events: none;
        }

        #labels {
            position: absolute;
            top: 10px; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }

        .station-marker {
            position: absolute;
            top: 40%;
            transform: translateX(-50%);
            color: #ff9900;
            font-size: 0.8rem;
            text-align: center;
            opacity: 0.5;
        }

        .station-marker.tuned {
            opacity: 1;
            color: #fff;
            text-shadow: 0 0 10px #fff;
        }

        /* Controls */
        #knob-container {
            margin-top: 2rem;
            position: relative;
            width: 100px; height: 100px;
        }

        #knob {
            width: 100%; height: 100%;
            background: radial-gradient(#333, #111);
            border-radius: 50%;
            border: 2px solid #555;
            position: relative;
            transform: rotate(0deg);
            cursor: grab;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        #knob::after {
            content: '';
            position: absolute;
            top: 10px; left: 50%;
            width: 4px; height: 10px;
            background: #ff9900;
            transform: translateX(-50%);
        }

        #readout {
            margin-top: 2rem;
            font-size: 1.5rem;
            height: 3rem;
            text-align: center;
        }

        #noise-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJibGFjayIvPjwvZmlsdGVyPjwvc3ZnPg=='); /* Placeholder for noise */
            opacity: 0.1;
            pointer-events: none;
        }

        canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%; opacity: 0.2; pointer-events: none;
        }

        .btn-start {
            margin-top: 1rem;
            background: #ff9900; color: #000; border: none; padding: 10px 20px; cursor: pointer;
            font-family: inherit; font-weight: bold;
        }

    </style>
</head>
<body>

    <canvas id="noise-canvas"></canvas>

    <h1 style="text-transform:uppercase; letter-spacing:2px;">Temporal Tuner</h1>

    <div id="tuner-display">
        <div id="frequency-scale"></div>
        <div id="labels">
            <!-- Populated by JS -->
        </div>
        <div id="needle"></div>
    </div>

    <div id="readout">SCANNING...</div>

    <div id="knob-container">
        <div id="knob"></div>
    </div>

    <button class="btn-start" onclick="initAudio()">POWER ON</button>
    <a href="index.html" style="margin-top:20px; color:#666; text-decoration:none;">EXIT</a>

    <script>
        const knob = document.getElementById('knob');
        const readout = document.getElementById('readout');
        const labelsContainer = document.getElementById('labels');
        const scale = document.getElementById('frequency-scale');
        
        let rotation = 0;
        let frequency = 50; // 0 - 100 range
        let isDragging = false;
        let startX, startRotation;

        // Stations (0-100 scale)
        const stations = [
            { freq: 15, name: "5G STATUS", msg: "Global latency stable at 0.8ms..." },
            { freq: 35, name: "AI REPORT", msg: "Neural core optimization complete..." },
            { freq: 60, name: "ORBIT LINK", msg: "Satellite handover verified..." },
            { freq: 85, name: "SECURE CH", msg: "Quantum key exchange successful..." }
        ];

        // Draw Labels
        stations.forEach(s => {
            const el = document.createElement('div');
            el.className = 'station-marker';
            // Determine position. Center is 50. Range is 0-100.
            // If freq is 50, left should be 50%.
            // But we move the SCALE, not the needle. 
            // Needle is fixed at 50%.
            // If scale moves left, freq increases.
            // Let's implement simpler logic: we move the needle visuals or scale visuals?
            // Moving scale is more realistic.
            el.style.left = s.freq + '%'; 
            el.innerText = s.freq.toFixed(1);
            labelsContainer.appendChild(el);
        });

        // Audio
        let audioCtx;
        let noiseNode, carrierNode, gainNode;

        function initAudio() {
            if(audioCtx) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            
            // White Noise
            const bufferSize = audioCtx.sampleRate * 2;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            
            noiseNode = audioCtx.createBufferSource();
            noiseNode.buffer = buffer;
            noiseNode.loop = true;
            
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.value = 0.1;
            
            noiseNode.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noiseNode.start();
            
            // Carrier Tone (The Signal)
            carrierNode = audioCtx.createOscillator();
            carrierNode.type = 'sine';
            carrierNode.frequency.value = 440;
            
            gainNode = audioCtx.createGain();
            gainNode.gain.value = 0;
            
            carrierNode.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            carrierNode.start();
            
            document.querySelector('.btn-start').style.display = 'none';
            updateTuner();
        }

        // Knob Logic
        knob.addEventListener('mousedown', startDrag);
        window.addEventListener('mouseup', stopDrag);
        window.addEventListener('mousemove', drag);
        
        // Touch
        knob.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
        window.addEventListener('touchend', stopDrag);
        window.addEventListener('touchmove', (e) => drag(e.touches[0]));

        function startDrag(e) {
            isDragging = true;
            startX = e.clientX;
            startRotation = rotation;
        }

        function stopDrag() {
            isDragging = false;
        }

        function drag(e) {
            if(!isDragging) return;
            const delta = e.clientX - startX;
            rotation = startRotation + delta;
            
            // Clamp visual rotation
            // Map rotation to frequency
            // Sensitivity
            frequency = Math.max(0, Math.min(100, 50 + rotation * 0.2));
            
            knob.style.transform = `rotate(${rotation}deg)`;
            updateTuner();
        }

        function updateTuner() {
            // Move Scale visually:
            // If freq is 50 (center), scale is centered.
            // If freq increases (turning right), scale moves left.
            // Need to map frequency 0-100 to translate X.
            // Center (50) -> 0px. 
            // 100 -> -50%.
            const offset = (50 - frequency) * 10; // Pixels
            scale.style.transform = `translateX(${offset}px)`;
            labelsContainer.style.transform = `translateX(${offset}px)`;
            
            checkStation();
        }

        function checkStation() {
            let signal = 0;
            let currentStation = null;
            
            stations.forEach(s => {
                const diff = Math.abs(frequency - s.freq);
                if(diff < 2) {
                    signal = 1 - (diff / 2); // 0 to 1 strength
                    currentStation = s;
                }
            });
            
            if(audioCtx) {
                // Audio Feedback
                if(currentStation) {
                    gainNode.gain.value = signal * 0.2;
                    carrierNode.frequency.value = 200 + (frequency * 5); // Pitch var
                    readout.innerText = signal > 0.8 ? currentStation.msg : "TUNING...";
                    readout.style.opacity = 0.5 + signal * 0.5;
                } else {
                    gainNode.gain.value = 0;
                    readout.innerText = "STATIC...";
                    readout.style.opacity = 0.5;
                }
            }
        }

        // Noise Visuals
        const nCanvas = document.getElementById('noise-canvas');
        const nCtx = nCanvas.getContext('2d');
        
        function drawNoise() {
            nCanvas.width = window.innerWidth;
            nCanvas.height = window.innerHeight;
            
            const w = nCanvas.width;
            const h = nCanvas.height;
            const idata = nCtx.createImageData(w, h);
            const buffer32 = new Uint32Array(idata.data.buffer);
            const len = buffer32.length;
            
            for (let i = 0; i < len; i++) {
                if (Math.random() < 0.1) {
                    buffer32[i] = 0xffffffff;
                }
            }
            nCtx.putImageData(idata, 0, 0);
            requestAnimationFrame(drawNoise);
        }
        drawNoise();

    </script>
</body>
</html>
